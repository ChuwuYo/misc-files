<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>番茄钟</title>
  <style>
    :root {
      --primary-color: #FF9AA2;
      --secondary-color: #FFB7B2;
      --accent-color: #FFDAC1;
      --text-color: #3D3D3D;
      --bg-color: #FFF5E4;
      --pixel-border: 2px solid #3D3D3D;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Press Start 2P', cursive, Arial, sans-serif;
    }

    body {
      background-color: var(--bg-color);
      color: var(--text-color);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }

    .container {
      width: 100%;
      max-width: 800px;
      background-color: var(--accent-color);
      border: var(--pixel-border);
      border-radius: 0;
      padding: 20px;
      box-shadow: 8px 8px 0px #3D3D3D;
      margin-top: 20px;
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
      font-size: 2rem;
      text-shadow: 3px 3px 0px var(--primary-color);
    }

    .timer-container {
      text-align: center;
      margin: 30px 0;
    }

    .timer {
      font-size: 4rem;
      margin: 20px 0;
      font-weight: bold;
      color: var(--text-color);
      text-shadow: 3px 3px 0px var(--primary-color);
    }

    .phase {
      font-size: 1.5rem;
      margin-bottom: 20px;
      color: var(--text-color);
    }

    .controls {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 30px;
    }

    .btn {
      padding: 12px 20px;
      border: var(--pixel-border);
      background-color: var(--primary-color);
      color: white;
      cursor: pointer;
      font-size: 1rem;
      transition: all 0.1s;
      box-shadow: 3px 3px 0px #3D3D3D;
    }

    .btn:hover {
      transform: translate(2px, 2px);
      box-shadow: 1px 1px 0px #3D3D3D;
    }

    .btn:active {
      transform: translate(3px, 3px);
      box-shadow: 0px 0px 0px #3D3D3D;
    }

    .btn-secondary {
      background-color: var(--secondary-color);
    }

    .stats {
      display: flex;
      justify-content: space-around;
      margin-bottom: 30px;
    }

    .stat-item {
      text-align: center;
    }

    .stat-value {
      font-size: 2rem;
      font-weight: bold;
    }

    .settings-panel {
      background-color: var(--accent-color);
      border: var(--pixel-border);
      padding: 20px;
      margin-top: 20px;
      display: none;
    }

    .settings-panel h2 {
      margin-bottom: 15px;
      text-align: center;
    }

    .setting-group {
      margin-bottom: 15px;
    }

    .setting-group label {
      display: block;
      margin-bottom: 5px;
    }

    .setting-group input {
      width: 100%;
      padding: 8px;
      border: var(--pixel-border);
    }

    .setting-row {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
    }

    .setting-option {
      flex: 1;
    }

    .toggle-container {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .toggle {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }

    .toggle input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border: var(--pixel-border);
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 4px;
      bottom: 2px;
      background-color: white;
      transition: .4s;
      border: var(--pixel-border);
    }

    input:checked + .slider {
      background-color: var(--primary-color);
    }

    input:checked + .slider:before {
      transform: translateX(26px);
    }

    .theme-selector {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    .theme-option {
      width: 30px;
      height: 30px;
      border-radius: 0;
      cursor: pointer;
      border: var(--pixel-border);
    }

    .pixel-character {
      position: absolute;
      bottom: 20px;
      right: 20px;
      width: 80px;
      height: 80px;
      background-color: var(--primary-color);
      border: var(--pixel-border);
      z-index: 10;
    }

    .completed {
      background-color: #B5EAD7;
      color: #3D3D3D;
    }

    /* 响应式设计 */
    @media (max-width: 600px) {
      .timer {
        font-size: 3rem;
      }
      .controls {
        flex-wrap: wrap;
      }
      .btn {
        flex: 1;
        min-width: 120px;
      }
    }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body>
  <h1>番茄钟</h1>
  
  <div class="container">
    <div class="timer-container">
      <div class="phase" id="phase">专注时间</div>
      <div class="timer" id="timer">25:00</div>
      <div class="controls">
        <button class="btn" id="startBtn">开始</button>
        <button class="btn" id="pauseBtn">暂停</button>
        <button class="btn btn-secondary" id="resetBtn">重置</button>
        <button class="btn btn-secondary" id="skipBtn">跳过</button>
      </div>
    </div>
    
    <div class="stats">
      <div class="stat-item">
        <div class="stat-label">已完成番茄</div>
        <div class="stat-value" id="completedCount">0</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">今日专注</div>
        <div class="stat-value" id="todayFocus">0分钟</div>
      </div>
    </div>
    
    <button class="btn" id="settingsBtn">设置</button>
  </div>
  
  <div class="settings-panel" id="settingsPanel">
    <h2>设置</h2>
    
    <div class="setting-group">
      <label>专注时长 (分钟)</label>
      <input type="number" id="focusTime" min="1" max="60" value="25">
    </div>
    
    <div class="setting-group">
      <label>短休息时长 (分钟)</label>
      <input type="number" id="shortBreakTime" min="1" max="30" value="5">
    </div>
    
    <div class="setting-group">
      <label>长休息时长 (分钟)</label>
      <input type="number" id="longBreakTime" min="1" max="60" value="15">
    </div>
    
    <div class="setting-group">
      <label>长休息间隔 (番茄数)</label>
      <input type="number" id="longBreakInterval" min="1" max="10" value="4">
    </div>
    
    <div class="setting-group toggle-container">
      <label>声音提示</label>
      <label class="toggle">
        <input type="checkbox" id="soundEnabled" checked>
        <span class="slider"></span>
      </label>
    </div>
    
    <div class="setting-group toggle-container">
      <label>自动开始下一个番茄</label>
      <label class="toggle">
        <input type="checkbox" id="autoStart" checked>
        <span class="slider"></span>
      </label>
    </div>
    
    <div class="setting-group">
      <label>主题颜色</label>
      <div class="theme-selector">
        <div class="theme-option" style="background-color: #FF9AA2;" data-theme="pink"></div>
        <div class="theme-option" style="background-color: #B5EAD7;" data-theme="mint"></div>
        <div class="theme-option" style="background-color: #C7CEEA;" data-theme="blue"></div>
        <div class="theme-option" style="background-color: #FFDAC1;" data-theme="orange"></div>
      </div>
    </div>
    
    <button class="btn" id="saveSettings">保存设置</button>
  </div>
  
  <div class="pixel-character"></div>

  <script>
    // 番茄钟状态管理
    const tomatoTimer = {
      // 状态变量
      isRunning: false,
      isPaused: false,
      currentPhase: 'focus', // focus, shortBreak, longBreak
      timeLeft: 25 * 60, // 秒
      intervalId: null,
      completedCount: 0,
      todayFocusTime: 0,
      focusCompleted: 0,
      
      // 默认设置
      settings: {
        focusTime: 25,
        shortBreakTime: 5,
        longBreakTime: 15,
        longBreakInterval: 4,
        soundEnabled: true,
        autoStart: true
      },
      
      // 初始化
      init() {
        this.loadSettings();
        this.updateDisplay();
        this.setupEventListeners();
        this.updateTodayFocus();
      },
      
      // 加载设置
      loadSettings() {
        const savedSettings = localStorage.getItem('tomatoTimerSettings');
        if (savedSettings) {
          this.settings = { ...this.settings, ...JSON.parse(savedSettings) };
        }
        
        // 更新设置表单
        document.getElementById('focusTime').value = this.settings.focusTime;
        document.getElementById('shortBreakTime').value = this.settings.shortBreakTime;
        document.getElementById('longBreakTime').value = this.settings.longBreakTime;
        document.getElementById('longBreakInterval').value = this.settings.longBreakInterval;
        document.getElementById('soundEnabled').checked = this.settings.soundEnabled;
        document.getElementById('autoStart').checked = this.settings.autoStart;
        
        // 设置初始时间
        this.timeLeft = this.settings.focusTime * 60;
      },
      
      // 保存设置
      saveSettings() {
        this.settings.focusTime = parseInt(document.getElementById('focusTime').value);
        this.settings.shortBreakTime = parseInt(document.getElementById('shortBreakTime').value);
        this.settings.longBreakTime = parseInt(document.getElementById('longBreakTime').value);
        this.settings.longBreakInterval = parseInt(document.getElementById('longBreakInterval').value);
        this.settings.soundEnabled = document.getElementById('soundEnabled').checked;
        this.settings.autoStart = document.getElementById('autoStart').checked;
        
        localStorage.setItem('tomatoTimerSettings', JSON.stringify(this.settings));
        
        // 如果当前阶段是专注，更新剩余时间
        if (this.currentPhase === 'focus') {
          this.timeLeft = this.settings.focusTime * 60;
          this.updateDisplay();
        }
        
        alert('设置已保存！');
      },
      
      // 设置事件监听器
      setupEventListeners() {
        document.getElementById('startBtn').addEventListener('click', () => this.start());
        document.getElementById('pauseBtn').addEventListener('click', () => this.pause());
        document.getElementById('resetBtn').addEventListener('click', () => this.reset());
        document.getElementById('skipBtn').addEventListener('click', () => this.skip());
        document.getElementById('settingsBtn').addEventListener('click', () => this.toggleSettings());
        document.getElementById('saveSettings').addEventListener('click', () => this.saveSettings());
        
        // 主题选择器
        document.querySelectorAll('.theme-option').forEach(option => {
          option.addEventListener('click', () => this.changeTheme(option.dataset.theme));
        });
        
        // 键盘快捷键
        document.addEventListener('keydown', (e) => {
          if (e.key === ' ' || e.key === 'Spacebar') {
            e.preventDefault();
            if (this.isRunning) {
              this.pause();
            } else {
              this.start();
            }
          } else if (e.key === 'r' || e.key === 'R') {
            this.reset();
          } else if (e.key === 's' || e.key === 'S') {
            this.skip();
          }
        });
      },
      
      // 开始计时
      start() {
        if (this.isRunning) return;
        
        this.isRunning = true;
        this.isPaused = false;
        
        this.intervalId = setInterval(() => {
          this.timeLeft--;
          this.updateDisplay();
          
          if (this.timeLeft <= 0) {
            this.completePhase();
          }
        }, 1000);
      },
      
      // 暂停计时
      pause() {
        if (!this.isRunning) return;
        
        this.isRunning = false;
        this.isPaused = true;
        clearInterval(this.intervalId);
      },
      
      // 重置计时
      reset() {
        this.isRunning = false;
        this.isPaused = false;
        clearInterval(this.intervalId);
        
        if (this.currentPhase === 'focus') {
          this.timeLeft = this.settings.focusTime * 60;
        } else if (this.currentPhase === 'shortBreak') {
          this.timeLeft = this.settings.shortBreakTime * 60;
        } else if (this.currentPhase === 'longBreak') {
          this.timeLeft = this.settings.longBreakTime * 60;
        }
        
        this.updateDisplay();
      },
      
      // 跳过当前阶段
      skip() {
        this.isRunning = false;
        clearInterval(this.intervalId);
        this.completePhase(true);
      },
      
      // 完成当前阶段
      completePhase(skipped = false) {
        clearInterval(this.intervalId);
        this.isRunning = false;
        
        if (this.currentPhase === 'focus') {
          if (!skipped) {
            this.completedCount++;
            this.focusCompleted++;
            this.todayFocusTime += this.settings.focusTime;
            this.updateTodayFocus();
            
            // 检查是否需要长休息
            if (this.focusCompleted % this.settings.longBreakInterval === 0) {
              this.currentPhase = 'longBreak';
              this.timeLeft = this.settings.longBreakTime * 60;
            } else {
              this.currentPhase = 'shortBreak';
              this.timeLeft = this.settings.shortBreakTime * 60;
            }
          } else {
            // 如果跳过了专注时间，重置专注计数
            this.currentPhase = 'shortBreak';
            this.timeLeft = this.settings.shortBreakTime * 60;
          }
        } else {
          // 休息时间结束，开始新的专注阶段
          this.currentPhase = 'focus';
          this.timeLeft = this.settings.focusTime * 60;
        }
        
        // 播放提示音
        if (this.settings.soundEnabled && !skipped) {
          this.playSound();
        }
        
        this.updateDisplay();
        
        // 自动开始下一个阶段
        if (this.settings.autoStart && !skipped) {
          setTimeout(() => this.start(), 1000);
        }
      },
      
      // 更新显示
      updateDisplay() {
        const minutes = Math.floor(this.timeLeft / 60);
        const seconds = this.timeLeft % 60;
        document.getElementById('timer').textContent = 
          `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        
        let phaseText = '';
        if (this.currentPhase === 'focus') {
          phaseText = '专注时间';
          document.body.classList.remove('completed');
        } else if (this.currentPhase === 'shortBreak') {
          phaseText = '短休息';
          document.body.classList.add('completed');
        } else if (this.currentPhase === 'longBreak') {
          phaseText = '长休息';
          document.body.classList.add('completed');
        }
        
        document.getElementById('phase').textContent = phaseText;
        document.getElementById('completedCount').textContent = this.completedCount;
      },
      
      // 更新今日专注时间
      updateTodayFocus() {
        document.getElementById('todayFocus').textContent = `${this.todayFocusTime}分钟`;
      },
      
      // 播放提示音
      playSound() {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.value = 880;
        oscillator.type = 'sine';
        
        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1);
        
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 1);
      },
      
      // 切换设置面板
      toggleSettings() {
        const settingsPanel = document.getElementById('settingsPanel');
        settingsPanel.style.display = settingsPanel.style.display === 'block' ? 'none' : 'block';
      },
      
      // 更改主题
      changeTheme(theme) {
        switch(theme) {
          case 'pink':
            document.documentElement.style.setProperty('--primary-color', '#FF9AA2');
            document.documentElement.style.setProperty('--secondary-color', '#FFB7B2');
            document.documentElement.style.setProperty('--accent-color', '#FFDAC1');
            document.documentElement.style.setProperty('--bg-color', '#FFF5E4');
            break;
          case 'mint':
            document.documentElement.style.setProperty('--primary-color', '#B5EAD7');
            document.documentElement.style.setProperty('--secondary-color', '#C7CEEA');
            document.documentElement.style.setProperty('--accent-color', '#E2F0CB');
            document.documentElement.style.setProperty('--bg-color', '#F5F5F5');
            break;
          case 'blue':
            document.documentElement.style.setProperty('--primary-color', '#C7CEEA');
            document.documentElement.style.setProperty('--secondary-color', '#B5EAD7');
            document.documentElement.style.setProperty('--accent-color', '#FFDAC1');
            document.documentElement.style.setProperty('--bg-color', '#F0F8FF');
            break;
          case 'orange':
            document.documentElement.style.setProperty('--primary-color', '#FFDAC1');
            document.documentElement.style.setProperty('--secondary-color', '#FFB7B2');
            document.documentElement.style.setProperty('--accent-color', '#E2F0CB');
            document.documentElement.style.setProperty('--bg-color', '#FFF8F0');
            break;
        }
        
        // 保存主题偏好
        localStorage.setItem('tomatoTimerTheme', theme);
      }
    };
    
    // 页面加载完成后初始化番茄钟
    document.addEventListener('DOMContentLoaded', () => {
      tomatoTimer.init();
      
      // 加载保存的主题
      const savedTheme = localStorage.getItem('tomatoTimerTheme');
      if (savedTheme) {
        tomatoTimer.changeTheme(savedTheme);
      }
    });
  </script>
</body>
</html>