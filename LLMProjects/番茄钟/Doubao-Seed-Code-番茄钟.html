<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>番茄钟</title>
    <style>
        /* 全局样式和重置 */
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }
        
        body {
            font-family: 'Press Start 2P', cursive;
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
            overflow-x: hidden;
            user-select: none;
        }
        
        /* 像素按钮基础样式 */
        .pixel-btn {
            display: inline-block;
            padding: 12px 24px;
            margin: 8px;
            font-family: inherit;
            font-size: 14px;
            background-color: #ff6b6b;
            color: white;
            border: 4px solid #000;
            cursor: pointer;
            position: relative;
            text-transform: uppercase;
            transition: all 0.1s;
            text-shadow: 2px 2px 0 #000;
            box-shadow: 4px 4px 0 #000;
        }
        
        .pixel-btn:hover {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0 #000;
        }
        
        .pixel-btn:active {
            transform: translate(4px, 4px);
            box-shadow: none;
        }
        
        .pixel-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: 4px 4px 0 #000;
        }
        
        /* 容器样式 */
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        
        /* 标题样式 */
        h1 {
            font-size: 2.5rem;
            margin-bottom: 30px;
            text-align: center;
            line-height: 1.2;
            text-shadow: 3px 3px 0 #000;
        }
        
        /* 计时器显示 */
        .timer-display {
            font-size: 4rem;
            margin: 20px 0;
            padding: 20px;
            border: 8px solid #000;
            background-color: #fff;
            border-radius: 0;
            box-shadow: 8px 8px 0 #000;
            min-width: 300px;
            text-align: center;
        }
        
        /* 状态显示 */
        .status-display {
            font-size: 1.5rem;
            margin-bottom: 20px;
            text-align: center;
        }
        
        /* 进度条 */
        .progress-container {
            width: 100%;
            max-width: 500px;
            height: 30px;
            border: 4px solid #000;
            margin-bottom: 30px;
            background-color: #ddd;
            position: relative;
            box-shadow: 4px 4px 0 #000;
        }
        
        .progress-bar {
            height: 100%;
            background-color: #ff6b6b;
            width: 100%;
            transition: width 1s linear;
            position: relative;
        }
        
        /* 控制按钮区域 */
        .controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 30px;
        }
        
        /* 统计区域 */
        .stats {
            font-size: 1.2rem;
            margin-bottom: 30px;
            padding: 15px;
            border: 4px solid #000;
            background-color: #fff;
            box-shadow: 4px 4px 0 #000;
        }
        
        /* 设置面板 */
        .settings {
            width: 100%;
            max-width: 500px;
            padding: 20px;
            border: 6px solid #000;
            background-color: #fff;
            margin-bottom: 30px;
            box-shadow: 6px 6px 0 #000;
        }
        
        .settings h2 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .settings-group {
            margin-bottom: 20px;
        }
        
        .settings-group label {
            display: block;
            margin-bottom: 10px;
            font-size: 1rem;
        }
        
        .settings-group input[type="number"],
        .settings-group input[type="range"] {
            width: 100%;
            padding: 8px;
            border: 3px solid #000;
            font-family: inherit;
            font-size: 1rem;
        }
        
        .settings-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 10px;
        }
        
        .settings-group checkbox-label {
            display: flex;
            align-items: center;
        }
        
        /* 主题切换 */
        .theme-selector {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        
        .theme-option {
            width: 30px;
            height: 30px;
            border: 3px solid #000;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .theme-option:hover {
            transform: scale(1.2);
        }
        
        .theme-option.active {
            transform: scale(1.2);
            border-color: #fff;
            box-shadow: 0 0 10px #fff;
        }
        
        /* 像素角色 */
        .pixel-character {
            margin: 20px 0;
            width: 128px;
            height: 128px;
            image-rendering: pixelated;
        }
        
        /* 响应式设计 */
        @media (max-width: 600px) {
            h1 {
                font-size: 1.8rem;
            }
            
            .timer-display {
                font-size: 2.5rem;
                min-width: 200px;
                padding: 15px;
            }
            
            .status-display {
                font-size: 1.2rem;
            }
            
            .pixel-btn {
                font-size: 12px;
                padding: 10px 20px;
            }
            
            .settings h2 {
                font-size: 1.2rem;
            }
            
            .settings-group label {
                font-size: 0.9rem;
            }
        }
        
        /* 深色主题 */
        body.dark-theme {
            background-color: #222;
            color: #fff;
        }
        
        body.dark-theme .timer-display,
        body.dark-theme .stats,
        body.dark-theme .settings {
            background-color: #444;
            color: #fff;
        }
        
        body.dark-theme .progress-container {
            background-color: #555;
        }
        
        /* 主题颜色 */
        /* 默认主题 - 红色系 */
        body.theme-default {
            background-color: #ffe6e6;
            color: #333;
        }
        
        body.theme-default h1 {
            color: #ff6b6b;
        }
        
        body.theme-default .pixel-btn {
            background-color: #ff6b6b;
        }
        
        body.theme-default .progress-bar {
            background-color: #ff6b6b;
        }
        
        /* 蓝色主题 */
        body.theme-blue {
            background-color: #e6f2ff;
            color: #333;
        }
        
        body.theme-blue h1 {
            color: #6ba3ff;
        }
        
        body.theme-blue .pixel-btn {
            background-color: #6ba3ff;
        }
        
        body.theme-blue .progress-bar {
            background-color: #6ba3ff;
        }
        
        /* 绿色主题 */
        body.theme-green {
            background-color: #e6ffe6;
            color: #333;
        }
        
        body.theme-green h1 {
            color: #6bff6b;
        }
        
        body.theme-green .pixel-btn {
            background-color: #6bff6b;
        }
        
        body.theme-green .progress-bar {
            background-color: #6bff6b;
        }
        
        /* 紫色主题 */
        body.theme-purple {
            background-color: #f0e6ff;
            color: #333;
        }
        
        body.theme-purple h1 {
            color: #a36bff;
        }
        
        body.theme-purple .pixel-btn {
            background-color: #a36bff;
        }
        
        body.theme-purple .progress-bar {
            background-color: #a36bff;
        }
        
        /* 黄色主题 */
        body.theme-yellow {
            background-color: #fff9e6;
            color: #333;
        }
        
        body.theme-yellow h1 {
            color: #ffcc6b;
        }
        
        body.theme-yellow .pixel-btn {
            background-color: #ffcc6b;
        }
        
        body.theme-yellow .progress-bar {
            background-color: #ffcc6b;
        }
        
        /* 动画效果 */
        @keyframes pixel-bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .bounce {
            animation: pixel-bounce 1s infinite;
        }
    </style>
</head>
<body class="theme-default">
    <div class="container">
        <h1>番茄钟</h1>
        
        <!-- 像素角色 -->
        <div class="pixel-character">
            <svg width="128" height="128" viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg">
                <!-- 简单像素角色 - 番茄 -->
                <rect x="48" y="32" width="32" height="40" fill="#ff6b6b" stroke="#000" stroke-width="4"/>
                <circle cx="64" cy="52" r="12" fill="#fff" stroke="#000" stroke-width="2"/>
                <circle cx="58" cy="48" r="2" fill="#000"/>
                <circle cx="70" cy="48" r="2" fill="#000"/>
                <path d="M58 60 Q64 68 70 60" stroke="#000" stroke-width="2" fill="none"/>
                <rect x="60" y="16" width="8" height="16" fill="#6bff6b" stroke="#000" stroke-width="2"/>
                <rect x="52" y="24" width="24" height="4" fill="#6bff6b" stroke="#000" stroke-width="2"/>
            </svg>
        </div>
        
        <!-- 计时器显示 -->
        <div class="timer-display" id="timer">25:00</div>
        <div class="status-display" id="status">准备开始工作</div>
        
        <!-- 进度条 -->
        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>
        
        <!-- 统计信息 -->
        <div class="stats">
            今日完成: <span id="completedCount">0</span> 个番茄钟
        </div>
        
        <!-- 控制按钮 -->
        <div class="controls">
            <button class="pixel-btn" id="startBtn">开始</button>
            <button class="pixel-btn" id="pauseBtn" disabled>暂停</button>
            <button class="pixel-btn" id="resetBtn">重置</button>
            <button class="pixel-btn" id="skipBtn">跳过</button>
        </div>
        
        <!-- 设置面板 -->
        <div class="settings">
            <h2>设置</h2>
            
            <!-- 时间设置 -->
            <div class="settings-group">
                <label for="workTime">工作时间 (分钟): <span id="workTimeValue">25</span></label>
                <input type="range" id="workTime" min="5" max="60" value="25">
            </div>
            
            <div class="settings-group">
                <label for="shortBreakTime">短休息时间 (分钟): <span id="shortBreakTimeValue">5</span></label>
                <input type="range" id="shortBreakTime" min="1" max="15" value="5">
            </div>
            
            <div class="settings-group">
                <label for="longBreakTime">长休息时间 (分钟): <span id="longBreakTimeValue">15</span></label>
                <input type="range" id="longBreakTime" min="10" max="30" value="15">
            </div>
            
            <!-- 音效设置 -->
            <div class="settings-group">
                <label for="soundVolume">音量: <span id="volumeValue">70</span>%</label>
                <input type="range" id="soundVolume" min="0" max="100" value="70">
            </div>
            
            <div class="settings-group">
                <label><input type="checkbox" id="autoPlay" checked> 自动开始下个时段</label>
            </div>
            
            <div class="settings-group">
                <label><input type="checkbox" id="soundEnabled" checked> 启用音效</label>
            </div>
            
            <div class="settings-group">
                <label><input type="checkbox" id="darkMode"> 深色模式</label>
            </div>
            
            <!-- 主题选择 -->
            <div class="settings-group">
                <label>主题颜色:</label>
                <div class="theme-selector">
                    <div class="theme-option theme-default" data-theme="default" style="background-color: #ff6b6b;"></div>
                    <div class="theme-option" data-theme="blue" style="background-color: #6ba3ff;"></div>
                    <div class="theme-option" data-theme="green" style="background-color: #6bff6b;"></div>
                    <div class="theme-option" data-theme="purple" style="background-color: #a36bff;"></div>
                    <div class="theme-option" data-theme="yellow" style="background-color: #ffcc6b;"></div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // 状态管理
        const state = {
            isRunning: false,
            currentPhase: 'work', // work, shortBreak, longBreak
            timeLeft: 25 * 60,
            totalTime: 25 * 60,
            timerInterval: null,
            completedPomodoros: 0,
            workSessionsCount: 0,
            
            // 设置
            workTime: 25,
            shortBreakTime: 5,
            longBreakTime: 15,
            soundEnabled: true,
            volume: 0.7,
            autoPlay: true,
            darkMode: false,
            theme: 'default'
        };
        
        // DOM元素
        const elements = {
            timer: document.getElementById('timer'),
            status: document.getElementById('status'),
            progressBar: document.getElementById('progressBar'),
            completedCount: document.getElementById('completedCount'),
            startBtn: document.getElementById('startBtn'),
            pauseBtn: document.getElementById('pauseBtn'),
            resetBtn: document.getElementById('resetBtn'),
            skipBtn: document.getElementById('skipBtn'),
            workTime: document.getElementById('workTime'),
            shortBreakTime: document.getElementById('shortBreakTime'),
            longBreakTime: document.getElementById('longBreakTime'),
            workTimeValue: document.getElementById('workTimeValue'),
            shortBreakTimeValue: document.getElementById('shortBreakTimeValue'),
            longBreakTimeValue: document.getElementById('longBreakTimeValue'),
            soundVolume: document.getElementById('soundVolume'),
            volumeValue: document.getElementById('volumeValue'),
            autoPlay: document.getElementById('autoPlay'),
            soundEnabled: document.getElementById('soundEnabled'),
            darkMode: document.getElementById('darkMode'),
            themeOptions: document.querySelectorAll('.theme-option')
        };
        
        // 音频上下文
        let audioContext;
        
        // 初始化
        function init() {
            loadSettings();
            updateDisplay();
            setupEventListeners();
            updateTheme();
        }
        
        // 加载设置
        function loadSettings() {
            const savedSettings = localStorage.getItem('pomodoroSettings');
            const savedStats = localStorage.getItem('pomodoroStats');
            
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                state.workTime = settings.workTime || 25;
                state.shortBreakTime = settings.shortBreakTime || 5;
                state.longBreakTime = settings.longBreakTime || 15;
                state.soundEnabled = settings.soundEnabled !== undefined ? settings.soundEnabled : true;
                state.volume = settings.volume !== undefined ? settings.volume : 0.7;
                state.autoPlay = settings.autoPlay !== undefined ? settings.autoPlay : true;
                state.darkMode = settings.darkMode !== undefined ? settings.darkMode : false;
                state.theme = settings.theme || 'default';
                
                // 更新设置UI
                elements.workTime.value = state.workTime;
                elements.shortBreakTime.value = state.shortBreakTime;
                elements.longBreakTime.value = state.longBreakTime;
                elements.workTimeValue.textContent = state.workTime;
                elements.shortBreakTimeValue.textContent = state.shortBreakTime;
                elements.longBreakTimeValue.textContent = state.longBreakTime;
                elements.soundVolume.value = Math.round(state.volume * 100);
                elements.volumeValue.textContent = Math.round(state.volume * 100);
                elements.autoPlay.checked = state.autoPlay;
                elements.soundEnabled.checked = state.soundEnabled;
                elements.darkMode.checked = state.darkMode;
            }
            
            if (savedStats) {
                const stats = JSON.parse(savedStats);
                const today = new Date().toDateString();
                
                if (stats.date === today) {
                    state.completedPomodoros = stats.completedPomodoros || 0;
                    elements.completedCount.textContent = state.completedPomodoros;
                } else {
                    // 重置每日统计
                    state.completedPomodoros = 0;
                    saveStats();
                }
            }
            
            // 初始化时间
            resetTimer();
        }
        
        // 保存设置
        function saveSettings() {
            const settings = {
                workTime: state.workTime,
                shortBreakTime: state.shortBreakTime,
                longBreakTime: state.longBreakTime,
                soundEnabled: state.soundEnabled,
                volume: state.volume,
                autoPlay: state.autoPlay,
                darkMode: state.darkMode,
                theme: state.theme
            };
            
            localStorage.setItem('pomodoroSettings', JSON.stringify(settings));
        }
        
        // 保存统计
        function saveStats() {
            const stats = {
                date: new Date().toDateString(),
                completedPomodoros: state.completedPomodoros
            };
            
            localStorage.setItem('pomodoroStats', JSON.stringify(stats));
        }
        
        // 设置事件监听器
        function setupEventListeners() {
            elements.startBtn.addEventListener('click', startTimer);
            elements.pauseBtn.addEventListener('click', pauseTimer);
            elements.resetBtn.addEventListener('click', resetTimer);
            elements.skipBtn.addEventListener('click', skipPhase);
            
            // 设置滑块事件
            elements.workTime.addEventListener('input', updateWorkTime);
            elements.shortBreakTime.addEventListener('input', updateShortBreakTime);
            elements.longBreakTime.addEventListener('input', updateLongBreakTime);
            elements.soundVolume.addEventListener('input', updateVolume);
            
            // 设置复选框事件
            elements.autoPlay.addEventListener('change', updateAutoPlay);
            elements.soundEnabled.addEventListener('change', updateSoundEnabled);
            elements.darkMode.addEventListener('change', toggleDarkMode);
            
            // 主题选择事件
            elements.themeOptions.forEach(option => {
                option.addEventListener('click', () => {
                    const theme = option.getAttribute('data-theme');
                    changeTheme(theme);
                });
            });
            
            // 键盘快捷键
            document.addEventListener('keydown', handleKeyPress);
        }
        
        // 处理键盘快捷键
        function handleKeyPress(e) {
            // 避免在输入框中触发快捷键
            if (e.target.tagName === 'INPUT') return;
            
            switch (e.key.toLowerCase()) {
                case ' ':
                    e.preventDefault();
                    if (state.isRunning) {
                        pauseTimer();
                    } else {
                        startTimer();
                    }
                    break;
                case 'r':
                    resetTimer();
                    break;
                case 's':
                    skipPhase();
                    break;
            }
        }
        
        // 更新工作时间
        function updateWorkTime() {
            state.workTime = parseInt(elements.workTime.value);
            elements.workTimeValue.textContent = state.workTime;
            
            if (state.currentPhase === 'work' && !state.isRunning) {
                state.timeLeft = state.workTime * 60;
                state.totalTime = state.workTime * 60;
                updateDisplay();
            }
            
            saveSettings();
        }
        
        // 更新短休息时间
        function updateShortBreakTime() {
            state.shortBreakTime = parseInt(elements.shortBreakTime.value);
            elements.shortBreakTimeValue.textContent = state.shortBreakTime;
            
            if (state.currentPhase === 'shortBreak' && !state.isRunning) {
                state.timeLeft = state.shortBreakTime * 60;
                state.totalTime = state.shortBreakTime * 60;
                updateDisplay();
            }
            
            saveSettings();
        }
        
        // 更新长休息时间
        function updateLongBreakTime() {
            state.longBreakTime = parseInt(elements.longBreakTime.value);
            elements.longBreakTimeValue.textContent = state.longBreakTime;
            
            if (state.currentPhase === 'longBreak' && !state.isRunning) {
                state.timeLeft = state.longBreakTime * 60;
                state.totalTime = state.longBreakTime * 60;
                updateDisplay();
            }
            
            saveSettings();
        }
        
        // 更新音量
        function updateVolume() {
            state.volume = parseInt(elements.soundVolume.value) / 100;
            elements.volumeValue.textContent = Math.round(state.volume * 100);
            saveSettings();
        }
        
        // 更新自动播放设置
        function updateAutoPlay() {
            state.autoPlay = elements.autoPlay.checked;
            saveSettings();
        }
        
        // 更新音效设置
        function updateSoundEnabled() {
            state.soundEnabled = elements.soundEnabled.checked;
            saveSettings();
        }
        
        // 切换深色模式
        function toggleDarkMode() {
            state.darkMode = elements.darkMode.checked;
            updateTheme();
            saveSettings();
        }
        
        // 改变主题
        function changeTheme(theme) {
            state.theme = theme;
            updateTheme();
            
            // 更新主题选择器UI
            elements.themeOptions.forEach(option => {
                option.classList.remove('active');
                if (option.getAttribute('data-theme') === theme) {
                    option.classList.add('active');
                }
            });
            
            saveSettings();
        }
        
        // 更新主题样式
        function updateTheme() {
            document.body.className = '';
            document.body.classList.add(`theme-${state.theme}`);
            
            if (state.darkMode) {
                document.body.classList.add('dark-theme');
            }
        }
        
        // 开始计时器
        function startTimer() {
            if (state.isRunning) return;
            
            state.isRunning = true;
            elements.startBtn.disabled = true;
            elements.pauseBtn.disabled = false;
            
            // 初始化音频上下文
            if (state.soundEnabled && !audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            
            // 播放开始音效
            playSound('start');
            
            state.timerInterval = setInterval(() => {
                state.timeLeft--;
                updateDisplay();
                
                if (state.timeLeft <= 0) {
                    clearInterval(state.timerInterval);
                    phaseCompleted();
                }
            }, 1000);
        }
        
        // 暂停计时器
        function pauseTimer() {
            if (!state.isRunning) return;
            
            state.isRunning = false;
            clearInterval(state.timerInterval);
            elements.startBtn.disabled = false;
            elements.pauseBtn.disabled = true;
            
            // 恢复原始标题
            document.title = '番茄钟';
        }
        
        // 重置计时器
        function resetTimer() {
            pauseTimer();
            
            if (state.currentPhase === 'work') {
                state.timeLeft = state.workTime * 60;
                state.totalTime = state.workTime * 60;
            } else if (state.currentPhase === 'shortBreak') {
                state.timeLeft = state.shortBreakTime * 60;
                state.totalTime = state.shortBreakTime * 60;
            } else {
                state.timeLeft = state.longBreakTime * 60;
                state.totalTime = state.longBreakTime * 60;
            }
            
            updateDisplay();
        }
        
        // 跳过当前阶段
        function skipPhase() {
            phaseCompleted(true);
        }
        
        // 阶段完成处理
        function phaseCompleted(isSkipped = false) {
            state.isRunning = false;
            clearInterval(state.timerInterval);
            elements.startBtn.disabled = false;
            elements.pauseBtn.disabled = true;
            
            // 播放结束音效
            if (!isSkipped) {
                playSound('end');
            }
            
            // 如果是工作阶段完成，增加计数
            if (state.currentPhase === 'work' && !isSkipped) {
                state.completedPomodoros++;
                state.workSessionsCount++;
                elements.completedCount.textContent = state.completedPomodoros;
                saveStats();
                
                // 添加完成动画效果
                elements.timer.classList.add('bounce');
                setTimeout(() => {
                    elements.timer.classList.remove('bounce');
                }, 1000);
            }
            
            // 确定下一个阶段
            let nextPhase;
            if (state.currentPhase === 'work') {
                // 每4个工作阶段后有一个长休息
                nextPhase = state.workSessionsCount % 4 === 0 ? 'longBreak' : 'shortBreak';
            } else {
                nextPhase = 'work';
            }
            
            // 切换到下一阶段
            switchPhase(nextPhase);
            
            // 如果启用自动播放，自动开始下一个阶段
            if (state.autoPlay) {
                setTimeout(startTimer, 1000);
            }
        }
        
        // 切换阶段
        function switchPhase(phase) {
            state.currentPhase = phase;
            
            switch (phase) {
                case 'work':
                    state.timeLeft = state.workTime * 60;
                    state.totalTime = state.workTime * 60;
                    elements.status.textContent = '准备开始工作';
                    break;
                case 'shortBreak':
                    state.timeLeft = state.shortBreakTime * 60;
                    state.totalTime = state.shortBreakTime * 60;
                    elements.status.textContent = '短休息';
                    break;
                case 'longBreak':
                    state.timeLeft = state.longBreakTime * 60;
                    state.totalTime = state.longBreakTime * 60;
                    elements.status.textContent = '长休息';
                    break;
            }
            
            updateDisplay();
        }
        
        // 更新显示
        function updateDisplay() {
            // 格式化时间
            const minutes = Math.floor(state.timeLeft / 60).toString().padStart(2, '0');
            const seconds = (state.timeLeft % 60).toString().padStart(2, '0');
            elements.timer.textContent = `${minutes}:${seconds}`;
            
            // 更新进度条
            const progress = (state.timeLeft / state.totalTime) * 100;
            elements.progressBar.style.width = `${progress}%`;
            
            // 更新页面标题（仅在运行时）
            if (state.isRunning) {
                document.title = `${minutes}:${seconds} - 番茄钟`;
            } else {
                document.title = '番茄钟';
            }
            
            // 更新状态文本
            if (state.isRunning) {
                if (state.currentPhase === 'work') {
                    elements.status.textContent = '专注工作中...';
                } else if (state.currentPhase === 'shortBreak') {
                    elements.status.textContent = '短休息时间';
                } else {
                    elements.status.textContent = '长休息时间';
                }
            }
        }
        
        // 播放音效
        function playSound(type) {
            if (!state.soundEnabled || !audioContext) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            gainNode.gain.value = 0.1 * state.volume;
            
            if (type === 'start') {
                // 开始音效 - 上升音调
                oscillator.type = 'square';
                oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(880, audioContext.currentTime + 0.1);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.3);
            } else if (type === 'end') {
                // 结束音效 - 完成旋律
                oscillator.type = 'square';
                oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.15);
                oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.3);
                oscillator.frequency.setValueAtTime(1046.50, audioContext.currentTime + 0.45);
                
                gainNode.gain.setValueAtTime(0.1 * state.volume, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.8);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.8);
            }
        }
        
        // 初始化应用
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>