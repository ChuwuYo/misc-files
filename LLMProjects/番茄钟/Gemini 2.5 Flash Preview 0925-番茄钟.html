<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>番茄钟</title>
    <style>
        /* --- 基础重置与像素化风格 --- */
        body {
            font-family: 'Courier New', Courier, monospace; /* 模拟像素感 */
            background-color: #e0f7fa; /* 浅薄荷绿/蓝背景，小清新 */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            color: #333;
            overflow: hidden;
        }

        /* 像素化容器 */
        .container {
            background-color: #ffffff; /* 主界面背景，米白 */
            border: 8px solid #aed581; /* 柔和的绿色边框 */
            border-radius: 15px;
            padding: 30px;
            box-shadow: 10px 10px 0px #8bc34a; /* 柔和的阴影 */
            text-align: center;
            width: 90%;
            max-width: 500px;
        }

        /* --- 标题与模式切换 --- */
        h1 {
            font-size: 1.8em;
            color: #4caf50; /* 绿色标题 */
            margin-bottom: 20px;
            text-shadow: 2px 2px 0 #c8e6c9;
        }

        .mode-tabs button {
            background: #f1f8e9; /* 极浅的绿色按钮 */
            border: 3px solid #aed581;
            padding: 8px 15px;
            margin: 0 5px;
            cursor: pointer;
            font-size: 0.9em;
            border-radius: 5px;
            transition: background-color 0.2s, transform 0.1s;
            color: #4caf50;
        }        .mode-tabs button:hover {
            background-color: #dcedc8;
        }

        .mode-tabs button.active {
            background-color: #8bc34a;            color: white;
            border-color: #689f38;
            transform: translateY(-1px);
        }

        /* --- 时间显示与进度条 --- */
        .timer-display {
            margin: 30px 0;
            position: relative;
            width: 200px;
            height: 200px;
            margin-left: auto;
            margin-right: auto;
        }

        #time-display {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            font-size: 4.5em;
            font-weight: bold;
            color: #388e3c; /* 深绿色数字 */
            text-align: center;
            line-height: 1;
            text-shadow: 3px 3px 0 #f5f5f5;
            z-index: 1;
            pointer-events: none;
        }

        /* 像素化进度环 (使用CSS conic-gradient模拟) */
        .progress-ring {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(#ff9800 0%, #ff9800 var(--progress-value), #f0f0f0 var(--progress-value), #f0f0f0 100%);
            /* 模拟像素边框 */
            box-shadow: inset 0 0 0 10px #fff, 0 0 0 12px #aed581;
        }

        /* --- 控制按钮 --- */
        .controls button {
            background-color: #ffcc80; /* 柔和的橙色/番茄色 */
            border: none;
            padding: 12px 25px;
            margin: 8px;
            font-size: 1em;
            cursor: pointer;
            border-radius: 5px;
            color: #5d4037;
            font-weight: bold;
            box-shadow: 3px 3px 0 #ffb74d;
            transition: all 0.1s;
        }

        .controls button:hover {
            background-color: #ffb74d;
        }

        .controls button:active {
            transform: translate(1px, 1px);
            box-shadow: 1px 1px 0 #ffb74d;
        }

        #skip-btn {
            background-color: #90a4ae; /* 灰色跳过 */
            box-shadow: 3px 3px 0 #78909c;
        }
        #skip-btn:hover {
            background-color: #78909c;
        }

        /* --- 统计与设置区域 --- */
        .stats {
            margin-top: 20px;
            font-size: 0.9em;
            color: #616161;
        }

        #settings-toggle {
            margin-top: 15px;
            background: none;
            border: none;
            color: #4caf50;
            cursor: pointer;
            text-decoration: underline;
            font-size: 0.8em;
        }

        .settings-panel {
            display: none; /* 默认隐藏 */
            border-top: 2px dashed #ccc;
            margin-top: 20px;
            padding-top: 15px;
            text-align: left;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .setting-item label {
            flex-grow: 1;
        }

        .setting-item input[type="number"], .setting-item select {
            width: 60px;
            padding: 5px;
            border: 2px solid #aed581;
            text-align: center;
            font-size: 1em;
            border-radius: 3px;
        }
        
        /* 像素化开关（Checkbox 模拟） */
        .switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 20px;
            background-color: #ccc;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .switch::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 16px;
            height: 16px;
            background-color: white;
            border-radius: 50%;
            transition: transform 0.2s;
        }

        .switch.checked {
            background-color: #4caf50;
        }

        .switch.checked::after {
            transform: translateX(20px);
        }

    </style>
</head>
<body>

    <div class="container">
        <h1>番茄钟</h1>

        <!-- 模式切换 -->
        <div class="mode-tabs">
            <button id="work-tab" class="active" data-mode="work">工作 (25m)</button>
            <button id="short-break-tab" data-mode="shortBreak">短休 (5m)</button>
            <button id="long-break-tab" data-mode="longBreak">长休 (15m)</button>
        </div>

        <!-- 计时器显示与进度 -->
        <div class="timer-display">
            <div class="progress-ring" id="progress-ring" style="--progress-value: 0%;"></div>
            <span id="time-display">25:00</span>
        </div>

        <!-- 核心控制按钮 -->
        <div class="controls">
            <button id="start-pause-btn">开始</button>
            <button id="reset-btn">重置</button>
            <button id="skip-btn">跳过</button>
        </div>
        
        <!-- 统计与设置 -->
        <div class="stats">
            <p>已完成番茄数: <span id="pomodoro-count">0</span></p>
        </div>

        <button id="settings-toggle">⚙️ 设置</button>

        <!-- 设置面板 -->
        <div class="settings-panel" id="settings-panel">            <div class="setting-item">
                <label for="work-duration">工作时长 (分钟):</label>
                <input type="number" id="work-duration" value="25" min="1" max="99">
            </div>
            <div class="setting-item">
                <label for="short-break-duration">短休时长 (分钟):</label>
                <input type="number" id="short-break-duration" value="5" min="1" max="60">
            </div>
            <div class="setting-item">
                <label for="long-break-duration">长休时长 (分钟):</label>
                <input type="number" id="long-break-duration" value="15" min="5" max="60">
            </div>
            <div class="setting-item">
                <label for="long-break-interval">长休间隔 (次):</label>
                <input type="number" id="long-break-interval" value="4" min="1" max="10">
            </div>
            <div class="setting-item">
                <label>声音提示:</label>
                <div class="switch" id="sound-toggle"></div>
            </div>
            <div class="setting-item">
                <label for="sound-select">完成音效:</label>
                <select id="sound-select">
                    <option value="chime1">像素叮咚 1</option>
                    <option value="chime2">像素铃铛 2</option>
                    <option value="chime3">像素提示 3</option>
                </select>
            </div>
            <button id="save-settings-btn" style="width: 100%; margin-top: 15px;">保存设置</button>
        </div>

    </div>

    <script>
        // --- 状态管理 ---
        const state = {
            isRunning: false,
            mode: 'work', // 'work', 'shortBreak', 'longBreak'
            timerId: null,
            totalSeconds: 0,
            currentSeconds: 0,
            pomodoroCount: 0,            settings: {
                work: 25 * 60,
                shortBreak: 5 * 60,
                longBreak: 15 * 60,
                longBreakInterval: 4,
                soundEnabled: true,
                currentSound: 'chime1'
            }
        };

        // --- DOM 元素获取 ---
        const timeDisplay = document.getElementById('time-display');
        const startPauseBtn = document.getElementById('start-pause-btn');
        const resetBtn = document.getElementById('reset-btn');
        const skipBtn = document.getElementById('skip-btn');
        const pomodoroCountSpan = document.getElementById('pomodoro-count');
        const progressRing = document.getElementById('progress-ring');
        const modeTabs = document.querySelectorAll('.mode-tabs button');
        const settingsToggle = document.getElementById('settings-toggle');
        const settingsPanel = document.getElementById('settings-panel');
        const soundToggleSwitch = document.getElementById('sound-toggle');

        // 模拟音效 (实际应用中，请将这些替换为实际的 .mp3 或 .wav 文件路径)
        const audioClips = {
            chime1: new Audio('data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEARKwAAARBடகAAAAAUE1RVjIAAAACAAAAAAAAAABAAAAAgAAAAAAAAAASW50ZXJuYWwgU291bmQgR2VuZXJhdG9y'), // 占位符，实际需替换
            chime2: new Audio('data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEARKwAAARBடகAAAAAUE1RVjIAAAACAAAAAAAAAABAAAAAgAAAAAAAAAASW50ZXJuYWwgU291bmQgR2VuZXJhdG9y'),            chime3: new Audio('data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEARKwAAARBடகAAAAAUE1RVjIAAAACAAAAAAAAAABAAAAAgAAAAAAAAAASW50ZXJuYWwgU291bmQgR2VuZXJhdG9y')
        };
        
        // --- 工具函数 ---

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }

        function updateProgressRing() {
            const percentage = (state.currentSeconds / state.totalSeconds) * 100;
            progressRing.style.setProperty('--progress-value', `${100 - percentage}%`);
        }

        function playSound() {
            if (state.settings.soundEnabled) {
                const audio = audioClips[state.settings.currentSound];
                if (audio) {
                    audio.currentTime = 0; // 重新播放
                    audio.play().catch(e => console.error("Audio playback failed:", e));
                }
            }
        }

        // --- 核心计时逻辑 ---

        function tick() {
            if (state.currentSeconds <= 0) {
                clearInterval(state.timerId);
                state.isRunning = false;
                handleTimerEnd();
                return;
            }            state.currentSeconds--;
            timeDisplay.textContent = formatTime(state.currentSeconds);
            updateProgressRing();
        }

        function startTimer() {
            if (state.isRunning) return;
            state.isRunning = true;
            startPauseBtn.textContent = '暂停';
            state.timerId = setInterval(tick, 1000);
        }

        function pauseTimer() {
            if (!state.isRunning) return;
            state.isRunning = false;
            clearInterval(state.timerId);
            startPauseBtn.textContent = '继续';
        }

        function resetTimer() {
            pauseTimer();
            setupMode(state.mode);
            startPauseBtn.textContent = '开始';
        }

        function handleTimerEnd() {
            playSound();
            
            let nextMode = '';
            let nextDuration = 0;

            if (state.mode === 'work') {
                state.pomodoroCount++;
                pomodoroCountSpan.textContent = state.pomodoroCount;

                if (state.pomodoroCount % state.settings.longBreakInterval === 0) {
                    nextMode = 'longBreak';
                } else {
                    nextMode = 'shortBreak';
                }
            } else {
                // 休息结束后，回到工作模式
                nextMode = 'work';
            }

            // 自动切换到下一模式
            setActiveMode(nextMode);
            // 提示用户，但可以设置是否自动开始
            alert(`${state.mode === 'work' ? '工作完成！' : '休息结束！'} 准备进入 ${nextMode === 'work' ? '工作' : (nextMode === 'shortBreak' ? '短休' : '长休')} 模式。`);
                        // 自动开始下一个阶段 (可选，这里设置为自动开始)
            setupMode(nextMode);
            startTimer();
        }
        
        function skipTimer() {
            pauseTimer();
            handleTimerEnd(); // 强制触发结束逻辑
        }


        // --- 模式切换与设置加载 ---

        function setupMode(mode) {
            state.mode = mode;
            let durationSeconds;
            let tabButton;

            switch (mode) {
                case 'work':
                    durationSeconds = state.settings.work;
                    tabButton = document.getElementById('work-tab');
                    break;
                case 'shortBreak':
                    durationSeconds = state.settings.shortBreak;
                    tabButton = document.getElementById('short-break-tab');
                    break;
                case 'longBreak':
                    durationSeconds = state.settings.longBreak;
                    tabButton = document.getElementById('long-break-tab');
                    break;
            }
            
            state.totalSeconds = durationSeconds;
            state.currentSeconds = durationSeconds;
            
            timeDisplay.textContent = formatTime(durationSeconds);
            updateProgressRing();
            updateTabLabels(mode);

            // 确保按钮状态正确
            startPauseBtn.textContent = '开始';
        }
        
        function updateTabLabels(activeMode) {
            modeTabs.forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.mode === activeMode) {
                    btn.classList.add('active');
                }
            });
        }

        function setActiveMode(mode) {
            if (!state.isRunning) {
                setupMode(mode);
            }
        }

        // --- 设置面板逻辑 ---
        
        function loadSettingsToUI() {
            document.getElementById('work-duration').value = state.settings.work / 60;
            document.getElementById('short-break-duration').value = state.settings.shortBreak / 60;
            document.getElementById('long-break-duration').value = state.settings.longBreak / 60;
            document.getElementById('long-break-interval').value = state.settings.longBreakInterval;
            
            // 声音开关
            soundToggleSwitch.classList.toggle('checked', state.settings.soundEnabled);
            
            // 音效选择
            document.getElementById('sound-select').value = state.settings.currentSound;
        }

        function saveSettings() {
            const workMin = parseInt(document.getElementById('work-duration').value) || 25;
            const shortMin = parseInt(document.getElementById('short-break-duration').value) || 5;
            const longMin = parseInt(document.getElementById('long-break-duration').value) || 15;
            const interval = parseInt(document.getElementById('long-break-interval').value) || 4;
            
            state.settings.work = workMin * 60;
            state.settings.shortBreak = shortMin * 60;
            state.settings.longBreak = longMin * 60;
            state.settings.longBreakInterval = interval;
            
            state.settings.soundEnabled = soundToggleSwitch.classList.contains('checked');
            state.settings.currentSound = document.getElementById('sound-select').value;

            // 如果计时器在运行，重置以应用新时间
            if (!state.isRunning) {
                resetTimer();
            } else {
                // 如果正在运行，只更新标签，计时器秒数不变（用户体验：运行时不改变正在进行的阶段长度）
                updateTabLabels(state.mode);
            }
            alert('设置已保存！');
        }
        
        // --- 事件绑定 ---

        startPauseBtn.addEventListener('click', () => {
            if (state.isRunning) {
                pauseTimer();
            } else {
                startTimer();
            }
        });

        resetBtn.addEventListener('click', resetTimer);
        skipBtn.addEventListener('click', skipTimer);

        // 模式切换事件
        modeTabs.forEach(tab => {
            tab.addEventListener('click', (e) => {
                if (!state.isRunning) {
                    setActiveMode(e.currentTarget.dataset.mode);
                } else {
                    if(confirm("计时器正在运行中，切换模式将重置当前时间，确定吗？")) {
                        pauseTimer();
                        setActiveMode(e.currentTarget.dataset.mode);
                    }
                }
            });
        });
        
        // 设置切换
        settingsToggle.addEventListener('click', () => {
            if (settingsPanel.style.display === 'block') {
                settingsPanel.style.display = 'none';
                settingsToggle.textContent = '⚙️ 设置';
            } else {
                loadSettingsToUI();
                settingsPanel.style.display = 'block';
                settingsToggle.textContent = '收起设置';
            }
        });
        
        document.getElementById('save-settings-btn').addEventListener('click', saveSettings);

        // 声音开关点击
        soundToggleSwitch.addEventListener('click', () => {
            soundToggleSwitch.classList.toggle('checked');
        });

        // --- 初始化 ---        
        function initialize() {
            // 初始加载设置到UI（如果需要显示默认值）
            loadSettingsToUI(); 
            // 初始化到工作模式
            setupMode('work');
            // 初始隐藏设置面板
            settingsPanel.style.display = 'none';
        }

        initialize();
    </script>
</body>
</html>